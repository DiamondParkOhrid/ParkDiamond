<!DOCTYPE html>
<html lang="mk">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Производи</title>
    <link rel="icon" href="../src/transparent%20logo.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="market_style.css" />
    <style>
        body {
            background-color: #eaf4ff;
            font-family: 'Segoe UI', sans-serif;
        }

        h1 {
            color: #007bff;
            font-weight: 700;
        }

        .product-card {
            background-color: #ffffff;
            border-radius: 1rem;
            padding: 1rem;
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 16px rgba(0, 123, 255, 0.2);
        }

        .product-title {
            font-size: 1.15rem;
            font-weight: 600;
            color: #0056b3;
        }

        .product-price {
            font-size: 1.1rem;
            font-weight: bold;
            color: #28a745;
        }

        .pagination-controls {
            margin: 2rem 0 1rem;
        }

        #loadingSpinner {
            display: none;
        }

        @media (max-width: 576px) {
            .product-title,
            .product-price {
                font-size: 1rem;
            }

            .product-card {
                padding: 0.8rem;
            }

            .search-sort-bar {
                flex-direction: column;
                align-items: center;
            }

            .pagination-controls {
                flex-direction: column;
                gap: 0.5rem;
                text-align: center;
            }

            .pagination-controls button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg fixed-top shadow-sm" style="background-color: royalblue;">
    <div class="container">
        <a class="navbar-brand text-white fw-bold" href="#" style="letter-spacing: 1px;">
            <img src="../src/transparent%20logo.png" alt="Diamond Market Logo" height="40" class="me-2" />
            Diamond Market
        </a>
        <button class="navbar-toggler btn-outline-light" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
            <span class="navbar-toggler-icon" style="filter: invert(1);"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarContent">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                <li class="nav-item"><a class="nav-link text-white" href="MarketIndex.html">Home</a></li>
                <li class="nav-item"><a class="nav-link activeNav" href="Product%20Catalog.html">Products</a></li>
                <li class="nav-item"><a class="nav-link text-white" href="AboutUs.html">About Us</a></li>
            </ul>
        </div>
    </div>
</nav>
<div style="padding-top: 90px;"></div>

<div class="container py-4">
    <h1 class="text-center mb-4">Product Catalog</h1>

    <div class="search-sort-bar d-flex justify-content-center flex-wrap gap-2 mb-4">
        <input type="text" id="productSearch" class="form-control w-100 w-sm-25" placeholder="Search Products..." />
        <select id="sortSelect" class="form-select w-100 w-sm-25">
            <option value="default">Sort</option>
            <option value="asc">Lowest price firs</option>
            <option value="desc">Highest price first</option>
        </select>

    </div>
    <div class="d-flex justify-content-center mb-3">
        <button id="toggleViewBtn" class="btn btn-outline-secondary btn-sm">Switch to List View</button>
    </div>
    <div class="text-center mb-3">
        <div id="loadingSpinner" class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <div id="topPagination"  class="pagination-controls d-flex justify-content-between align-items-center d-none">
        <button id="top-prev-page" class="btn btn-outline-primary btn-sm">◀ Претходна</button>
        <span id="top-page-info" class="text-muted small"></span>
        <button id="top-next-page" class="btn btn-outline-primary btn-sm">Следна ▶</button>
    </div>

    <div id="product-list" class="row g-4 mt-2"></div>

    <div id="bottomPagination" class="pagination-controls d-flex justify-content-between align-items-center">
        <button id="bottom-prev-page" class="btn btn-outline-primary btn-sm">◀ Previous</button>
        <span id="bottom-page-info" class="text-muted small"></span>
        <button id="bottom-next-page" class="btn btn-outline-primary btn-sm">Next ▶</button>
    </div>
    <p id="lastUpdated" class="text-center text-muted mb-4"></p>
</div>


<footer class=" text-white pt-4"  style="background-color: royalblue;">
    <div class="container">
        <div class="row text-center text-md-start align-items-center g-4" id="footer-content">

            <!-- Contact Section -->
            <div class="col-md-4 contact">
                <h5>Contact Us</h5>
                <p class="d-flex align-items-center">
                    <img src="../src/ikoni/phone-call.png" alt="Phone" class="me-2 inverted-icon" width="24">
                    <a href="tel:+38978442675" class="text-white text-decoration-none me-2">+38978442675</a>
                    <a href="tel:+38978333807" class="text-white text-decoration-none">+38978333807</a>
                </p>
                <p class="d-flex align-items-center">
                    <img src="../src/ikoni/gmail.png" alt="Email" class="me-2" width="24">
                    <a href="mailto:diamondohrid@gmail.com" class="text-white text-decoration-none">diamondohrid@gmail.com</a>
                </p>
            </div>

            <!-- Social Section -->
            <div class="col-md-4 social text-center">
                <h5>Follow Us!</h5>
                <div class="d-flex justify-content-center gap-3 mt-2 flex-wrap">
                    <a href="https://facebook.com"><img src="../src/ikoni/facebook.png" alt="Facebook" width="32" class="inverted-icon"></a>
                    <a href="https://www.instagram.com/parkdiamond_apartments/"><img src="../src/ikoni/instagram.png" alt="Instagram" width="32" class="inverted-icon"></a>
                    <a href="viber://forward?text=Здраво, дали имате слободен апартман?"><img src="../src/ikoni/viber.png" alt="Viber" width="32" class="inverted-icon"></a>
                    <a href="https://www.booking.com/hotel/mk/park-diamond-apartments.html"><img src="../src/ikoni/booking.png" alt="Booking" width="32" class="inverted-icon"></a>
                    <a href="https://www.tripadvisor.com/Hotel_Review-g303864-d15674452-Reviews-Park_Diamond_Apartments-Ohrid_Southwestern_Region.html"><img src="../src/ikoni/tripadvisor.png" alt="TripAdvisor" width="32" class="inverted-icon"></a>
                </div>
            </div>

            <!-- Map Section -->
            <div class="col-md-4 location">
                <h5>Location</h5>
                <div class="ratio ratio-4x3" style="max-height: 200px; overflow: hidden;">
                    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3007.0354131637796!2d20.797149115416627!3d41.090072879292634!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x1350dca4598774a5%3A0x4ad88810e443cf29!2sPark%20Diamond%20Apartments!5e0!3m2!1sen!2smk!4v1690368394584!5m2!1sen!2smk"
                            allowfullscreen loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                </div>
            </div>
        </div>

        <!-- Footer Bottom -->
        <div class="text-center mt-4 pt-3 border-top border-white">
      <span>&copy; Market Diamond 2025. Developed by
        <a href="mailto:kostoskid66@gmail.com" class="text-white fw-bold text-decoration-none">Daniel Kostoski</a>
      </span>
        </div>
    </div>
</footer>

<button id="backToTopBtn" class="btn btn-light position-fixed bottom-0 end-0 m-3 rounded-circle p-2 shadow"
        style="color: #0d3b66; font-weight: 700; font-size: 1.5rem;">
    ↑
</button>
<script>
    document.getElementById("backToTopBtn").addEventListener("click", function () {
        window.scrollTo({ top: 0, behavior: "smooth" });
    });

    let products = [];
    let filteredProducts = [];
    let currentPage = 1;
    let totalPages = 1;
    let isCardView = true; // Start with card view

    function getProductsPerPage() {
        return window.innerWidth < 576 ? 4 : 8;
    }
    function getLastMondayAt10AM() {
        const now = new Date();
        const day = now.getDay(); // Sunday=0, Monday=1, ...
        const daysSinceMonday = (day + 6) % 7; // days since last Monday

        const lastMonday = new Date(now);
        lastMonday.setDate(now.getDate() - daysSinceMonday);
        lastMonday.setHours(10, 0, 0, 0); // 10:00 AM exactly

        // If it’s before Monday 10 AM this week, go back 1 week more
        if (now < lastMonday) {
            lastMonday.setDate(lastMonday.getDate() - 7);
        }

        return lastMonday;
    }

    function timeAgo(date) {
        const now = new Date();
        const diffMs = now - date; // milliseconds diff
        const diffSec = Math.floor(diffMs / 1000);
        const diffMin = Math.floor(diffSec / 60);
        const diffHrs = Math.floor(diffMin / 60);
        const diffDays = Math.floor(diffHrs / 24);

        if (diffMin < 1) return "Last updated just now";
        if (diffMin < 60) return `Last updated ${diffMin} minute${diffMin === 1 ? '' : 's'} ago`;
        if (diffHrs < 24) return `Last updated ${diffHrs} hour${diffHrs === 1 ? '' : 's'} ago`;
        return `Last updated ${diffDays} day${diffDays === 1 ? '' : 's'} ago`;
    }

    let productsPerPage = getProductsPerPage();

    const productSearch = document.getElementById('productSearch');
    const sortSelect = document.getElementById('sortSelect');
    const productList = document.getElementById('product-list');
    const loadingSpinner = document.getElementById('loadingSpinner');
    const toggleViewBtn = document.getElementById('toggleViewBtn');

    function parseCSV(csvText) {
        const lines = csvText.trim().split('\n');
        return lines.slice(1).map(line => {
            const [id, title, price] = line.split(',').map(v => v.trim());
            return {
                id,
                title,
                price: parseFloat(price)
            };
        });
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function sortProducts() {
        const sort = sortSelect.value;
        if (sort === 'asc') filteredProducts.sort((a, b) => a.price - b.price);
        else if (sort === 'desc') filteredProducts.sort((a, b) => b.price - a.price);
        else shuffleArray(filteredProducts);
    }

    function renderProducts() {
        productList.innerHTML = '';
        productsPerPage = getProductsPerPage();
        totalPages = Math.ceil(filteredProducts.length / productsPerPage);
        sortProducts();

        const start = (currentPage - 1) * productsPerPage;
        const currentProducts = filteredProducts.slice(start, start + productsPerPage);

        if (currentProducts.length === 0) {
            productList.innerHTML = '<p class="text-center text-muted">No products found.</p>';
            return;
        }

        currentProducts.forEach(p => {
            const col = document.createElement('div');
            col.className = 'col-12 ' + (isCardView ? 'col-sm-6 col-md-4 col-lg-3' : '');

            const card = document.createElement('div');
            card.className = isCardView ? 'product-card text-center mx-auto' : 'border p-3 bg-white rounded shadow-sm mb-2';
            card.style.maxWidth = isCardView ? '90%' : '100%';

            card.innerHTML = `
                <div class="product-title">${p.title}</div>
                <div class="product-price">${p.price} MKD</div>
            `;

            col.appendChild(card);
            productList.appendChild(col);
        });

        document.getElementById('top-page-info').textContent = `Page ${currentPage} of ${totalPages}`;
        document.getElementById('bottom-page-info').textContent = `Page ${currentPage} of ${totalPages}`;

        document.getElementById('top-prev-page').disabled = currentPage === 1;
        document.getElementById('bottom-prev-page').disabled = currentPage === 1;
        document.getElementById('top-next-page').disabled = currentPage === totalPages;
        document.getElementById('bottom-next-page').disabled = currentPage === totalPages;
    }

    function filterProducts() {
        const query = productSearch.value.trim().toLowerCase();
        filteredProducts = products.filter(p => p.title.toLowerCase().includes(query));
        currentPage = 1;
        renderProducts();
    }

    productSearch.addEventListener('input', filterProducts);
    sortSelect.addEventListener('change', renderProducts);

    window.addEventListener('resize', () => {
        productsPerPage = getProductsPerPage();
        totalPages = Math.ceil(filteredProducts.length / productsPerPage);
        currentPage = Math.min(currentPage, totalPages);
        renderProducts();
    });

    ['top', 'bottom'].forEach(loc => {
        document.getElementById(`${loc}-prev-page`).addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                renderProducts();
            }
        });
        document.getElementById(`${loc}-next-page`).addEventListener('click', () => {
            if (currentPage < totalPages) {
                currentPage++;
                renderProducts();
            }
        });
    });

    toggleViewBtn.addEventListener('click', () => {
        isCardView = !isCardView;
        toggleViewBtn.textContent = isCardView ? "Switch to List View" : "Switch to Card View";
        renderProducts();
    });

    window.addEventListener('DOMContentLoaded', () => {
        loadingSpinner.style.display = 'inline-block';
        const lastMonday = getLastMondayAt10AM();
        const message = timeAgo(lastMonday);
        document.getElementById('lastUpdated').textContent = message;
        fetch('cenovnik.csv')
            .then(res => res.text())
            .then(csv => {
                products = parseCSV(csv);
                filteredProducts = [...products];
                shuffleArray(filteredProducts);
                renderProducts();
            })
            .catch(() => {
                productList.innerHTML = '<p class="text-danger text-center">Failed to load products.</p>';
            })
            .finally(() => loadingSpinner.style.display = 'none');
    });
</script>
<script>
    document.querySelectorAll('.navbar-collapse .nav-link').forEach(function(navLink) {
        navLink.addEventListener('click', function () {
            const navbarToggler = document.querySelector('.navbar-toggler');
            const navbarCollapse = document.querySelector('.navbar-collapse');

            if (window.getComputedStyle(navbarToggler).display !== 'none') {
                new bootstrap.Collapse(navbarCollapse).hide();
            }
        });
    });
</script>
</body>
</html>
